{"ast":null,"code":"import React,{useState,useRef,useEffect}from'react';import{Dialog,DialogTitle,DialogContent,DialogActions,Button,Box,Typography,Alert,CircularProgress}from'@mui/material';import{checkInWithQR}from'../api';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const QRCodeScanner=_ref=>{let{open,onClose,onSuccess}=_ref;const[scanning,setScanning]=useState(false);const[error,setError]=useState('');const[success,setSuccess]=useState('');const videoRef=useRef(null);const streamRef=useRef(null);useEffect(()=>{if(open){startCamera();}else{stopCamera();}},[open]);const startCamera=async()=>{try{setScanning(true);setError('');setSuccess('');const stream=await navigator.mediaDevices.getUserMedia({video:{facingMode:'environment'// Use back camera if available\n}});streamRef.current=stream;if(videoRef.current){videoRef.current.srcObject=stream;}}catch(err){setError('Nu s-a putut accesa camera. Verificați permisiunile.');setScanning(false);}};const stopCamera=()=>{if(streamRef.current){streamRef.current.getTracks().forEach(track=>track.stop());streamRef.current=null;}setScanning(false);};const handleClose=()=>{stopCamera();setError('');setSuccess('');onClose();};const handleManualQR=()=>{const qrData=prompt('Introduceți datele QR code:');if(qrData){processQRData(qrData);}};const processQRData=async qrData=>{try{setError('');setSuccess('');const response=await checkInWithQR(qrData);setSuccess(response.data.msg);if(onSuccess){onSuccess(response.data);}// Close dialog after 2 seconds\nsetTimeout(()=>{handleClose();},2000);}catch(err){var _err$response,_err$response$data;setError(((_err$response=err.response)===null||_err$response===void 0?void 0:(_err$response$data=_err$response.data)===null||_err$response$data===void 0?void 0:_err$response$data.msg)||'Eroare la procesarea QR code-ului');}};return/*#__PURE__*/_jsxs(Dialog,{open:open,onClose:handleClose,maxWidth:\"sm\",fullWidth:true,children:[/*#__PURE__*/_jsx(DialogTitle,{children:\"Scanare QR Code pentru Check-in\"}),/*#__PURE__*/_jsx(DialogContent,{children:/*#__PURE__*/_jsxs(Box,{display:\"flex\",flexDirection:\"column\",alignItems:\"center\",gap:2,children:[error&&/*#__PURE__*/_jsx(Alert,{severity:\"error\",children:error}),success&&/*#__PURE__*/_jsx(Alert,{severity:\"success\",children:success}),scanning?/*#__PURE__*/_jsxs(Box,{position:\"relative\",width:\"100%\",maxWidth:400,children:[/*#__PURE__*/_jsx(\"video\",{ref:videoRef,autoPlay:true,playsInline:true,style:{width:'100%',height:'auto',borderRadius:'8px'}}),/*#__PURE__*/_jsx(Box,{position:\"absolute\",top:\"50%\",left:\"50%\",transform:\"translate(-50%, -50%)\",width:\"200px\",height:\"200px\",border:\"2px solid #1976d2\",borderRadius:\"8px\",sx:{'&::before':{content:'\"\"',position:'absolute',top:'-2px',left:'-2px',right:'-2px',bottom:'-2px',border:'2px solid #1976d2',borderRadius:'8px',animation:'pulse 2s infinite'}}}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",textAlign:\"center\",sx:{mt:2,color:'text.secondary'},children:\"Pozi\\u021Biona\\u021Bi QR code-ul \\xEEn cadrul de scanare\"})]}):/*#__PURE__*/_jsxs(Box,{textAlign:\"center\",py:4,children:[/*#__PURE__*/_jsx(CircularProgress,{}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",sx:{mt:2},children:\"Se ini\\u021Bializeaz\\u0103 camera...\"})]}),/*#__PURE__*/_jsx(Button,{variant:\"outlined\",onClick:handleManualQR,fullWidth:true,sx:{mt:2},children:\"Introducere manual\\u0103 QR code\"})]})}),/*#__PURE__*/_jsxs(DialogActions,{children:[/*#__PURE__*/_jsx(Button,{onClick:handleClose,children:\"Anuleaz\\u0103\"}),/*#__PURE__*/_jsx(Button,{onClick:startCamera,variant:\"contained\",disabled:scanning,children:scanning?'Se scanează...':'Începe scanarea'})]})]});};export default QRCodeScanner;","map":{"version":3,"names":["React","useState","useRef","useEffect","Dialog","DialogTitle","DialogContent","DialogActions","Button","Box","Typography","Alert","CircularProgress","checkInWithQR","jsx","_jsx","jsxs","_jsxs","QRCodeScanner","_ref","open","onClose","onSuccess","scanning","setScanning","error","setError","success","setSuccess","videoRef","streamRef","startCamera","stopCamera","stream","navigator","mediaDevices","getUserMedia","video","facingMode","current","srcObject","err","getTracks","forEach","track","stop","handleClose","handleManualQR","qrData","prompt","processQRData","response","data","msg","setTimeout","_err$response","_err$response$data","maxWidth","fullWidth","children","display","flexDirection","alignItems","gap","severity","position","width","ref","autoPlay","playsInline","style","height","borderRadius","top","left","transform","border","sx","content","right","bottom","animation","variant","textAlign","mt","color","py","onClick","disabled"],"sources":["C:/Users/trand/Documents/site_crr/site/src/components/QRCodeScanner.js"],"sourcesContent":["import React, { useState, useRef, useEffect } from 'react';\r\nimport {\r\n  Dialog,\r\n  DialogTitle,\r\n  DialogContent,\r\n  DialogActions,\r\n  Button,\r\n  Box,\r\n  Typography,\r\n  Alert,\r\n  CircularProgress\r\n} from '@mui/material';\r\nimport { checkInWithQR } from '../api';\r\n\r\nconst QRCodeScanner = ({ open, onClose, onSuccess }) => {\r\n  const [scanning, setScanning] = useState(false);\r\n  const [error, setError] = useState('');\r\n  const [success, setSuccess] = useState('');\r\n  const videoRef = useRef(null);\r\n  const streamRef = useRef(null);\r\n\r\n  useEffect(() => {\r\n    if (open) {\r\n      startCamera();\r\n    } else {\r\n      stopCamera();\r\n    }\r\n  }, [open]);\r\n\r\n  const startCamera = async () => {\r\n    try {\r\n      setScanning(true);\r\n      setError('');\r\n      setSuccess('');\r\n      \r\n      const stream = await navigator.mediaDevices.getUserMedia({ \r\n        video: { \r\n          facingMode: 'environment' // Use back camera if available\r\n        } \r\n      });\r\n      \r\n      streamRef.current = stream;\r\n      if (videoRef.current) {\r\n        videoRef.current.srcObject = stream;\r\n      }\r\n    } catch (err) {\r\n      setError('Nu s-a putut accesa camera. Verificați permisiunile.');\r\n      setScanning(false);\r\n    }\r\n  };\r\n\r\n  const stopCamera = () => {\r\n    if (streamRef.current) {\r\n      streamRef.current.getTracks().forEach(track => track.stop());\r\n      streamRef.current = null;\r\n    }\r\n    setScanning(false);\r\n  };\r\n\r\n  const handleClose = () => {\r\n    stopCamera();\r\n    setError('');\r\n    setSuccess('');\r\n    onClose();\r\n  };\r\n\r\n  const handleManualQR = () => {\r\n    const qrData = prompt('Introduceți datele QR code:');\r\n    if (qrData) {\r\n      processQRData(qrData);\r\n    }\r\n  };\r\n\r\n  const processQRData = async (qrData) => {\r\n    try {\r\n      setError('');\r\n      setSuccess('');\r\n      \r\n      const response = await checkInWithQR(qrData);\r\n      \r\n      setSuccess(response.data.msg);\r\n      \r\n      if (onSuccess) {\r\n        onSuccess(response.data);\r\n      }\r\n      \r\n      // Close dialog after 2 seconds\r\n      setTimeout(() => {\r\n        handleClose();\r\n      }, 2000);\r\n      \r\n    } catch (err) {\r\n      setError(err.response?.data?.msg || 'Eroare la procesarea QR code-ului');\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Dialog open={open} onClose={handleClose} maxWidth=\"sm\" fullWidth>\r\n      <DialogTitle>Scanare QR Code pentru Check-in</DialogTitle>\r\n      <DialogContent>\r\n        <Box display=\"flex\" flexDirection=\"column\" alignItems=\"center\" gap={2}>\r\n          {error && <Alert severity=\"error\">{error}</Alert>}\r\n          {success && <Alert severity=\"success\">{success}</Alert>}\r\n          \r\n          {scanning ? (\r\n            <Box position=\"relative\" width=\"100%\" maxWidth={400}>\r\n              <video\r\n                ref={videoRef}\r\n                autoPlay\r\n                playsInline\r\n                style={{ width: '100%', height: 'auto', borderRadius: '8px' }}\r\n              />\r\n              <Box\r\n                position=\"absolute\"\r\n                top=\"50%\"\r\n                left=\"50%\"\r\n                transform=\"translate(-50%, -50%)\"\r\n                width=\"200px\"\r\n                height=\"200px\"\r\n                border=\"2px solid #1976d2\"\r\n                borderRadius=\"8px\"\r\n                sx={{\r\n                  '&::before': {\r\n                    content: '\"\"',\r\n                    position: 'absolute',\r\n                    top: '-2px',\r\n                    left: '-2px',\r\n                    right: '-2px',\r\n                    bottom: '-2px',\r\n                    border: '2px solid #1976d2',\r\n                    borderRadius: '8px',\r\n                    animation: 'pulse 2s infinite'\r\n                  }\r\n                }}\r\n              />\r\n              <Typography \r\n                variant=\"body2\" \r\n                textAlign=\"center\" \r\n                sx={{ mt: 2, color: 'text.secondary' }}\r\n              >\r\n                Poziționați QR code-ul în cadrul de scanare\r\n              </Typography>\r\n            </Box>\r\n          ) : (\r\n            <Box textAlign=\"center\" py={4}>\r\n              <CircularProgress />\r\n              <Typography variant=\"body2\" sx={{ mt: 2 }}>\r\n                Se inițializează camera...\r\n              </Typography>\r\n            </Box>\r\n          )}\r\n          \r\n          <Button\r\n            variant=\"outlined\"\r\n            onClick={handleManualQR}\r\n            fullWidth\r\n            sx={{ mt: 2 }}\r\n          >\r\n            Introducere manuală QR code\r\n          </Button>\r\n        </Box>\r\n      </DialogContent>\r\n      <DialogActions>\r\n        <Button onClick={handleClose}>\r\n          Anulează\r\n        </Button>\r\n        <Button \r\n          onClick={startCamera} \r\n          variant=\"contained\"\r\n          disabled={scanning}\r\n        >\r\n          {scanning ? 'Se scanează...' : 'Începe scanarea'}\r\n        </Button>\r\n      </DialogActions>\r\n    </Dialog>\r\n  );\r\n};\r\n\r\nexport default QRCodeScanner;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}